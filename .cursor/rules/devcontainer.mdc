---
description: Devcontaineré–‹ç™ºç’°å¢ƒãƒ«ãƒ¼ãƒ«ï¼ˆAPPIé–¢é€£æ³•ä»¤KBï¼‰
globs: [".devcontainer/**/*", "docker-compose.yml", "Dockerfile"]
alwaysApply: true
---

# Devcontainer é–‹ç™ºç’°å¢ƒãƒ«ãƒ¼ãƒ«

## åŸºæœ¬æ–¹é‡

### ã‚³ãƒ³ãƒ†ãƒŠæˆ¦ç•¥
- **çµ±ä¸€ç’°å¢ƒ**: å…¨é–‹ç™ºè€…ãŒåŒä¸€ç’°å¢ƒã§ä½œæ¥­
- **å†ç¾æ€§**: æœ¬ç•ªç’°å¢ƒã¨ã®å·®ç•°ã‚’æœ€å°åŒ–
- **åˆ†é›¢æ€§**: ãƒ›ã‚¹ãƒˆOSã«ä¾å­˜ã—ãªã„é–‹ç™ºç’°å¢ƒ
- **åŠ¹ç‡æ€§**: é«˜é€Ÿãªèµ·å‹•ãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œ

### ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸é¸æŠ
- **å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸å„ªå…ˆ**: Microsoftå…¬å¼Devcontainerã‚¤ãƒ¡ãƒ¼ã‚¸
- **æœ€å°æ§‹æˆ**: å¿…è¦æœ€å°é™ã®ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: å®šæœŸçš„ãªãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸æ›´æ–°

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãƒ«ãƒ¼ãƒ«

### devcontainer.json
```json
{
  "name": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆè‹±èªï¼‰",
  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/workspace",
  
  "features": {
    // å¿…è¦æœ€å°é™ã®featureã®ã¿
  },
  
  "customizations": {
    "vscode": {
      "extensions": [
        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¿…é ˆæ‹¡å¼µæ©Ÿèƒ½ã®ã¿
      ],
      "settings": {
        // çµ±ä¸€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
      }
    }
  }
}
```

### Dockerfile
```dockerfile
# å…¬å¼ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ä½¿ç”¨
FROM mcr.microsoft.com/devcontainers/typescript-node:1-20-bookworm

# ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚ï¼ˆå¿…è¦æœ€å°é™ï¼‰
RUN apt-get update && export DEBIAN_FRONTEND=noninteractive \
    && apt-get -y install --no-install-recommends \
        # å…·ä½“çš„ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å
    && apt-get autoremove -y && apt-get clean -y

# æ—¥æœ¬èªç’°å¢ƒï¼ˆAPPIé–¢é€£ã§å¿…é ˆï¼‰
RUN sed -i '/ja_JP.UTF-8/s/^# //g' /etc/locale.gen && locale-gen
ENV LANG=ja_JP.UTF-8

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼šérootãƒ¦ãƒ¼ã‚¶ãƒ¼
USER vscode
```

## VS Code çµ±åˆ

### å¿…é ˆæ‹¡å¼µæ©Ÿèƒ½
- **TypeScript**: `ms-vscode.vscode-typescript-next`
- **ESLint**: `ms-vscode.vscode-eslint`
- **Prettier**: `esbenp.prettier-vscode`
- **Markdown**: `yzhang.markdown-all-in-one`
- **PDF**: `ms-vscode.vscode-pdf`ï¼ˆæ³•ä»¤æ–‡æ›¸é–²è¦§ç”¨ï¼‰

### çµ±ä¸€è¨­å®š
```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "typescript.preferences.importModuleSpecifier": "relative",
  "files.associations": {
    "*.mdc": "markdown"
  }
}
```

### ç¦æ­¢äº‹é …
- å€‹äººè¨­å®šã®å¼·åˆ¶ï¼ˆthemeç­‰ï¼‰
- é‡ã„æ‹¡å¼µæ©Ÿèƒ½ï¼ˆAIè£œå®Œç­‰ã¯å€‹äººåˆ¤æ–­ï¼‰
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è€ƒæ…®ï¼‰

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ãƒœãƒªãƒ¥ãƒ¼ãƒ æˆ¦ç•¥
```yaml
volumes:
  # ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆï¼šæ°¸ç¶šåŒ–ãŒå¿…è¦
  - ../sources:/workspace/sources:cached
  - ../ingested:/workspace/ingested:cached
  
  # åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–
  - node_modules:/workspace/node_modules
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨
```dockerfile
# ä¾å­˜é–¢ä¿‚ã®äº‹å‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
COPY package*.json ./
RUN npm ci --only=production=false
```

### ãƒ¡ãƒ¢ãƒªãƒ»CPUæ¨å¥¨å€¤
- **ãƒ¡ãƒ¢ãƒª**: 4GBä»¥ä¸Šï¼ˆPDFå‡¦ç†è€ƒæ…®ï¼‰
- **CPU**: 2ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ‡ã‚£ã‚¹ã‚¯**: 10GBä»¥ä¸Š

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™
```yaml
networks:
  appi-kb-network:
    driver: bridge
    # å¤–éƒ¨é€šä¿¡ã¯å®˜å…¬åºã‚µã‚¤ãƒˆã®ã¿
```

### æ¨©é™ç®¡ç†
- **érootãƒ¦ãƒ¼ã‚¶ãƒ¼**: `vscode` ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œ
- **ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™**: é©åˆ‡ãªæ‰€æœ‰è€…è¨­å®š
- **ç§˜å¯†æƒ…å ±**: ç’°å¢ƒå¤‰æ•°ãƒ»Secretsã§ç®¡ç†

### å¤–éƒ¨é€šä¿¡
- **HTTPSå¿…é ˆ**: å®˜å…¬åºã‚µã‚¤ãƒˆã¸ã®é€šä¿¡ã®ã¿
- **ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ**: ä¼æ¥­ç’°å¢ƒã§ã®åˆ©ç”¨è€ƒæ…®
- **ãƒ­ã‚°è¨˜éŒ²**: ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ä¿æŒ

## é–‹ç™ºä½“é¨“

### è‡ªå‹•åŒ–
```json
{
  "postCreateCommand": "npm install && npm run build",
  "postStartCommand": "echo 'ğŸš€ Ready! Run: npm run ingest'"
}
```

### ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
```bash
# .zshrc ã«è¿½åŠ 
alias ll="ls -la"
alias ingest="npm run ingest"
alias build="npm run build"
```

### ãƒãƒ¼ãƒˆè»¢é€
```json
{
  "forwardPorts": [3000, 8080],
  "portsAttributes": {
    "3000": {
      "label": "Dev Server",
      "onAutoForward": "notify"
    }
  }
}
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å…±é€šå•é¡Œãƒ»è§£æ±ºç­–

#### 1. æ¨©é™ã‚¨ãƒ©ãƒ¼
```bash
# ç—‡çŠ¶ï¼šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ»ç·¨é›†ãŒã§ããªã„
# è§£æ±ºï¼šæ‰€æœ‰è€…ä¿®æ­£
sudo chown -R vscode:vscode /workspace
```

#### 2. Node.jsä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼
```bash
# ç—‡çŠ¶ï¼šnpm installå¤±æ•—
# è§£æ±ºï¼šã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
rm -rf node_modules package-lock.json
npm install
```

#### 3. æ—¥æœ¬èªæ–‡å­—åŒ–ã‘
```bash
# ç—‡çŠ¶ï¼šPDFãƒ»HTMLã®æ—¥æœ¬èªãŒè¡¨ç¤ºã•ã‚Œãªã„
# è§£æ±ºï¼šãƒ­ã‚±ãƒ¼ãƒ«ãƒ»ãƒ•ã‚©ãƒ³ãƒˆç¢ºèª
locale
apt list --installed | grep fonts-noto
```

#### 4. ãƒ¡ãƒ¢ãƒªä¸è¶³
```bash
# ç—‡çŠ¶ï¼šPDFå‡¦ç†ã§ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
# è§£æ±ºï¼šDockerãƒ¡ãƒ¢ãƒªåˆ¶é™ç·©å’Œ
# Docker Desktop > Settings > Resources > Memory
```

## ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### å®šæœŸæ›´æ–°
- **æœˆæ¬¡**: ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸æ›´æ–°
- **å››åŠæœŸ**: æ‹¡å¼µæ©Ÿèƒ½ãƒ»ä¾å­˜é–¢ä¿‚è¦‹ç›´ã—
- **å¹´æ¬¡**: Node.jsãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°

### æ›´æ–°æ‰‹é †
```bash
# 1. è¨­å®šå¤‰æ›´
vim .devcontainer/devcontainer.json

# 2. ãƒªãƒ“ãƒ«ãƒ‰
> Dev Containers: Rebuild Container

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test
npm run ingest -- --dry-run
```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§
```bash
# è¨­å®šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
tar -czf devcontainer-backup.tar.gz .devcontainer/

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
> Dev Containers: Rebuild Container (No Cache)
```

## å°†æ¥æ‹¡å¼µ

### è¿½åŠ ã‚µãƒ¼ãƒ“ã‚¹å€™è£œ
```yaml
# Elasticsearchï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰
elasticsearch:
  image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
  environment:
    - discovery.type=single-node
    - xpack.security.enabled=false

# Redisï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
redis:
  image: redis:7-alpine
  command: redis-server --appendonly yes

# PostgreSQLï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿DBï¼‰
postgres:
  image: postgres:15-alpine
  environment:
    - POSTGRES_DB=appi_kb
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=postgres
```

### æœ‰åŠ¹åŒ–æ¡ä»¶
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡æ‹¡å¤§
- æ¤œç´¢æ€§èƒ½è¦æ±‚
- ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

## CI/CD é€£æº

### GitHub Actions
```yaml
# .github/workflows/devcontainer-test.yml
- name: Test in Devcontainer
  uses: devcontainers/ci@v0.3
  with:
    imageName: ghcr.io/${{ github.repository }}/devcontainer
    runCmd: npm test
```

### å“è³ªã‚²ãƒ¼ãƒˆ
- **ãƒ“ãƒ«ãƒ‰æˆåŠŸ**: TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
- **ãƒ†ã‚¹ãƒˆé€šé**: å˜ä½“ãƒ»çµåˆãƒ†ã‚¹ãƒˆ
- **ãƒªãƒ³ãƒˆé€šé**: ESLintãƒ»Prettier
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³
